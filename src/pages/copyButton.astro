<style is:global>
    .astro-code .code-copy {
      position: sticky;
      top: 0;
      left: calc(100% - 40px);
      margin-right: -20px;
      margin-bottom: -30px;
      opacity: .75;
      cursor: pointer;
      transition: opacity .2s ease-in-out;
    }
    .astro-code .code-copy:hover {
      opacity: 1;
    }
    .astro-code .code-copy.copied {
      left: calc(100% - 58px);
      opacity: 1;
    }
  </style>
      <script>
    
    function handleCopyClick(e: MouseEvent) {
      const target = e.target as HTMLButtonElement & {
        _timerId: NodeJS.Timeout;
      };
      let copyText = target.closest('pre')?.querySelector('code')?.innerText;

      if(!copyText) return;

      navigator.clipboard.writeText(copyText);
      target.classList.add('copied');
      target.innerText = 'Copied!';

      if(target._timerId) {
        clearTimeout(target._timerId);
      }
      target._timerId = setTimeout(() => {
        target.innerText = "Copy";
        target.classList.remove('copied');
      }, 2000);
    }

          const codeBlocks = document.querySelectorAll("pre.astro-code")

          codeBlocks.forEach(div => {
              // create the copy button
              const copy = document.createElement("button")
              copy.innerHTML = "Copy";
      copy.classList.add('code-copy');
              // add the event listener to each click
              copy.addEventListener("click", handleCopyClick)
              // prepend the copy button to each code block
              div.prepend(copy)
          });
      </script>